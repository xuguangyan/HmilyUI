/*
 * jQuery hmilyUI plug-in
 * http://www.dasheng.com/
 *
 * Copyright (c) 2013-2018
 * Author: xuguangyan
 *
 * Date: 2013-10-27
 * Revision: 1.2.0
 */

/** base.js **/
(function($){var _Debug=false;$.log=function(msg){if(_Debug){console.log(msg)}};Function.prototype.hmilyExtend=function(parent,overrides){if(typeof parent!="function"){return this}this.base=parent.prototype;this.base.constructor=parent;var f=function(){};f.prototype=parent.prototype;this.prototype=new f();this.prototype.constructor=this;if(overrides){$.extend(this.prototype,overrides)}};Function.prototype.hmilyDefer=function(o,defer,args){var fn=this;return setTimeout(function(){fn.apply(o,args||[])},defer)};window.hmily=$.hmilyui={version:"V1.2.0",managerCount:0,managers:{},managerIdPrev:"hmilyui",autoNewId:true,error:{managerIsExist:"管理器id已经存在"},pluginPrev:"hmily",getId:function(prev){prev=prev||this.managerIdPrev;var id=prev+(1000+this.managerCount);this.managerCount++;return id},add:function(manager){if(arguments.length==2){var m=arguments[1];m.id=m.id||m.options.id||arguments[0].id;this.addManager(m);return}if(!manager.id){manager.id=this.getId(manager.__idPrev())}if(this.managers[manager.id]){manager.id=this.getId(manager.__idPrev())}if(this.managers[manager.id]){throw new Error(this.error.managerIsExist)}this.managers[manager.id]=manager},remove:function(arg){if(typeof arg=="string"||typeof arg=="number"){delete hmily.managers[arg]}else{if(typeof arg=="object"){if(arg instanceof hmily.core.Component){delete hmily.managers[arg.id]}else{if(!$(arg).attr(this.idAttrName)){return false}delete hmily.managers[$(arg).attr(this.idAttrName)]}}}},get:function(arg,idAttrName){idAttrName=idAttrName||"hmilyuiid";if(typeof arg=="string"||typeof arg=="number"){return hmily.managers[arg]}else{if(typeof arg=="object"){var domObj=arg.length?arg[0]:arg;var id=domObj[idAttrName]||$(domObj).attr(idAttrName);if(!id){return null}return hmily.managers[id]}}return null},find:function(type){var arr=[];for(var id in this.managers){var manager=this.managers[id];if(type instanceof Function){if(manager instanceof type){arr.push(manager)}}else{if(type instanceof Array){if($.inArray(manager.__getType(),type)!=-1){arr.push(manager)}}else{if(manager.__getType()==type){arr.push(manager)}}}}return arr},run:function(plugin,args,ext){if(!plugin){return}ext=$.extend({defaultsNamespace:"hmilyDefaults",methodsNamespace:"hmilyMethods",controlNamespace:"controls",idAttrName:"hmilyuiid",isStatic:false,hasElement:true,propertyToElemnt:null},ext||{});plugin=plugin.replace(/^hmilyGet/,"");plugin=plugin.replace(/^hmily/,"");if(this==null||this==window||ext.isStatic){if(!hmily.plugins[plugin]){hmily.plugins[plugin]={fn:$[hmily.pluginPrev+plugin],isStatic:true}}return new $.hmilyui[ext.controlNamespace][plugin]($.extend({},$[ext.defaultsNamespace][plugin]||{},$[ext.defaultsNamespace][plugin+"String"]||{},args.length>0?args[0]:{}))}},defaults:{},methods:{},core:{},controls:{},plugins:{}};$.hmilyDefaults={};$.hmilyMethos={};hmily.defaults=$.hmilyDefaults;hmily.methods=$.hmilyMethos;hmily.core.Component=function(options){this.events=this.events||{};this.options=options||{};this.children={}};$.extend(hmily.core.Component.prototype,{__getType:function(){return"hmily.core.Component"},__idPrev:function(){return"hmilyui"}});hmily.core.UIComponent=function(element,options){hmily.core.UIComponent.base.constructor.call(this,options);this.element=element;this._init();this._render()};hmily.core.UIComponent.hmilyExtend(hmily.core.Component,{__getType:function(){return"hmily.core.UIComponent"},_init:function(){this.type=this.__getType();if(!this.element){this.id=this.options.id||hmily.getId(this.__idPrev())}else{this.id=this.options.id||this.element.id||hmily.getId(this.__idPrev())}hmily.add(this);if(!this.element){return}},_render:function(){},destroy:function(){if(this.element){$(this.element).remove()}this.options=null;hmily.remove(this)}});hmily.win={top:false,mask:function(win){function setHeight(){if(!hmily.win.windowMask){return}var h=$(window).height();hmily.win.windowMask.height(h)}if(!this.windowMask){this.windowMask=$("<div class='h-dialog-mask' style='display: block;'></div>").appendTo("body");$(window).bind("resize.hmilyuiwin",setHeight)}this.windowMask.show();setHeight();this.masking=true},unmask:function(win){var jwins=$("body > .l-dialog:visible,body > .l-window:visible");for(var i=0,l=jwins.length;i<l;i++){var winid=jwins.eq(i).attr("hmilyuiid");if(win&&win.id==winid){continue}var winmanager=hmily.get(winid);if(!winmanager){continue}var modal=winmanager.get("modal");if(modal){return}}if(this.windowMask){this.windowMask.hide()}this.masking=false},setFront:function(win){var wins=hmily.find(hmily.core.Win);for(var i in wins){var w=wins[i];if(w==win){$(w.element).css("z-index","9200")}else{$(w.element).css("z-index","9100")}}}};hmily.core.Win=function(element,options){hmily.core.Win.base.constructor.call(this,element,options)};hmily.core.Win.hmilyExtend(hmily.core.UIComponent,{__getType:function(){return"hmily.controls.Win"},mask:function(){if(this.options.modal){hmily.win.mask(this)}},unmask:function(){if(this.options.modal){hmily.win.unmask(this)
}},min:function(){},max:function(){},active:function(win){hmily.win.setFront(win)}})})(jQuery);

/** hmilyDrag.js **/
(function($){$.fn.hmilyDrag=function(options){return this.each(function(){var $this=$(this);var defaults={"handler":$this,"shadow":true};var p=$.extend(defaults,options);var $handler=p.handler;if(p.shadow){var $shadow=$(".h-dialog-shadow");if($shadow.length<=0){$shadow=$("<div></div>").addClass("h-dialog-shadow").width($this.width()).height($this.height).css({"opacity":0.5,"z-index":9300}).appendTo("body").hide()}}var isPress=false,isStart=false,originX,originY;$handler.mousedown(function(e){isStart=false;isPress=true;var x=$this.position().left;var y=$this.position().top;originX=e.pageX-x;originY=e.pageY-y;if(p.shadow){$shadow.css({left:x+"px",top:y+"px"}).show();$shadow.width($this.width()).height($this.height()).unbind("mousemove").unbind("mouseup").unbind("mouseout");$shadow.mousemove(function(e){if(isPress){if(!isStart){$.log("start drag");if(typeof p.start=="function"){p.start()}isStart=true}var x=e.pageX-originX;var y=e.pageY-originY;$(this).css({left:x+"px",top:y+"px"})}return false});$shadow.mouseup(function(e){$.log("end drag");if(typeof p.end=="function"){p.end()}isStart=false;isPress=false;var x=$(this).position().left;var y=$(this).position().top;$this.css({left:x+"px",top:y+"px"});$(this).hide();return false});$shadow.mouseout(function(e){if(isPress){isPress=false;$(this).hide()}return false})}else{$handler.unbind("mousemove").unbind("mouseup").unbind("mouseout");$handler.mousemove(function(e){if(isPress){if(!isStart){$.log("start drag");if(typeof p.start=="function"){p.start()}isStart=true}var x=e.pageX-originX;var y=e.pageY-originY;$this.css({left:x+"px",top:y+"px"})}return false});$handler.mouseup(function(e){$.log("end drag");if(typeof p.end=="function"){p.end()}isStart=false;isPress=false;return false});$handler.mouseout(function(e){isPress=false;return false})}})})}})(jQuery);

/** hmilyDialog.js **/
(function($){var h=$.hmilyui;$.hmilyDialog=function(options){return h.run.call(this,"hmilyDialog",arguments,{isStatic:true})};$.hmilyDefaults.Dialog={cls:null,id:null,buttons:null,width:300,height:200,showMax:false,showMin:false,alpha:1,title:"提示",content:"",modal:true,closeWhenEnter:null,closeWhenEsc:null,load:false};$.hmilyDefaults.DialogString={titleMessage:"提示",ok:"确定",yes:"是",no:"否",cancel:"取消",waittingMessage:"正在等待中,请稍候..."};h.controls.Dialog=function(options){h.controls.Dialog.base.constructor.call(this,null,options)};h.controls.Dialog.hmilyExtend(hmily.core.Win,{__getType:function(){return"hmily.controls.Dialog"},_render:function(){var g=this,p=this.options;p.width=(p.width<100)?100:p.width;p.height=(p.height<65)?65:p.height;var dialog=$('<div class="h-dialog"><div class="h-window-bar"><div class="h-window-bar-l"><span class="h-window-icon"></span><span class="h-window-title"></span></div><div class="h-window-bar-r"><span class="h-window-close"></span><span class="h-window-max"></span><span class="h-window-min"></span></div></div><div class="h-window-content"></div><div class="h-window-bot"></div></div>');dialog.css({"opacity":p.alpha,"z-index":9200}).appendTo("body");g.element=dialog[0];g.dialog=dialog;g.dialog.bar=dialog.find(".h-window-bar");g.dialog.content=dialog.find(".h-window-content");g.dialog.bot=dialog.find(".h-window-bot");if(p.cls){g.dialog.addClass(p.cls)}if(p.id){g.dialog.attr("id",p.id)}if(!p.buttons){g.dialog.bot.remove()}var _width=p.width-13;var _height=p.height-g.dialog.bar.height()-g.dialog.bot.height()-9;g._setTitle(p.title);if(p.type&&p.type!=""&&p.type!="none"){g._setImage()}else{if(p.target){var html=$(p.target).clone().show().prop("outerHTML");g._setContent(html)}else{if(p.url){if(p.timeParmName){p.url+=p.url.indexOf("?")==-1?"?":"&";p.url+=p.timeParmName+"="+new Date().getTime()}if(p.load){g.dialog.content.load(p.url,function(){g._saveStatus()})}else{g.dialog.content.html("");g.jiframe=$("<iframe frameborder='0' width='100%' height='100%' scrolling='yes'></iframe>");var framename=p.name?p.name:"hmilywindow"+new Date().getTime();g.jiframe.attr("name",framename);g.jiframe.attr("id",framename);g.dialog.content.prepend(g.jiframe);g.dialog.content.css({padding:0});_width+=12;_height+=6;setTimeout(function(){g.jiframe.attr("src",p.url);g.frame=window.frames[g.jiframe.attr("name")]},0);tmpId="jquery_hmilyui_"+new Date().getTime();g.tmpInput=$("<input></input>");g.tmpInput.attr("id",tmpId).hide();g.dialog.content.prepend(g.tmpInput)}}else{g._setContent(p.content)}}}if(p.buttons&&p.buttons.length>0){$(p.buttons).each(function(i,item){var btn=$('<input class="winBtn" type="button" value="'+item.text+'" />');g.dialog.bot.prepend(btn);item.width&&btn.width(item.width);item.onclick&&btn.click(function(){item.onclick(item,g,i)})})}dialog.width(p.width).height(p.height);g.dialog.bar.width(p.width);dialog.find(".h-window-bar-l").width(p.width-dialog.find(".h-window-bar-r").width());dialog.find(".h-window-title").width(p.width-dialog.find(".h-window-bar-r").width()-dialog.find(".h-window-icon").width()-6);g.dialog.content.width(_width).height(_height);g.dialog.bot.width(p.width);var left=0;var top=0;var width=p.width;if(p.slide==true){p.slide="fast"}if(p.left!=null){left=p.left}else{p.left=left=0.5*($(window).width()-width)}if(p.top!=null){top=p.top}else{p.top=top=0.5*(document.body.clientHeight-g.dialog.height())-10}if(left<0){p.left=left=0}if(top<0){p.top=top=0}g.dialog.css({left:left,top:top});var btnClose=dialog.find(".h-window-close");var btnMax=dialog.find(".h-window-max");var btnMin=dialog.find(".h-window-min");p.showMax?btnMax.show():btnMax.hide();p.showMin?btnMin.show():btnMin.hide();btnClose.mousedown(function(){return false});btnMax.mousedown(function(){return false});btnMin.mousedown(function(){return false});btnClose.click(function(){g.close();return false});btnMax.click(function(){alert("最大化窗口");return false});btnMin.click(function(){alert("最小化窗口");return false});dialog.mousedown(function(e){g.active(g)});$("body").bind("keydown.dialog",function(e){var key=e.which;if(key==13){g.enter()}else{if(key==27){g.esc()}}});this.show();dialog.hmilyDrag({"handler":g.dialog.bar})},_saveStatus:function(){var g=this;g._width=g.dialog.content.width();g._height=g.dialog.content.height();var top=0;var left=0;if(!isNaN(parseInt(g.dialog.css("top")))){top=parseInt(g.dialog.css("top"))}if(!isNaN(parseInt(g.dialog.css("left")))){left=parseInt(g.dialog.css("left"))}g._top=top;g._left=left},_setImage:function(){var g=this,p=this.options;if(!p.type){return}g.dialog.content.html('<div class="h-dialog-icon"></div><div class="h-dialog-tips"></div>');var iconStyle="h-icon-info";switch(p.type){case"done":case"success":case"ok":iconStyle="h-icon-done";break;case"error":iconStyle="h-icon-error";break;case"info":iconStyle="h-icon-info";break;case"question":iconStyle="h-icon-question";break;case"warn":iconStyle="h-icon-warn";break}$(".h-dialog-icon",g.dialog).addClass(iconStyle);$(".h-dialog-tips",g.dialog).html(p.content)
},_setContent:function(content){if(content){this.dialog.content.html(content)}},_setTitle:function(value){var g=this;var p=this.options;if(value){$(".h-window-title",g.dialog).html(value)}},enter:function(){var g=this,p=this.options;var isClose;if(p.closeWhenEnter){isClose=p.closeWhenEnter}else{if(p.type&&p.type!=""&&p.type!="none"){isClose=true}}if(isClose){g.close()}},esc:function(){var g=this,p=this.options;var isClose;if(p.closeWhenEsc){isClose=p.closeWhenEsc}else{if(p.type&&p.type!=""&&p.type!="none"){isClose=true}}if(isClose){g.close()}},hide:function(){var g=this,p=this.options;this.unmask();this.dialog.hide()},show:function(){var g=this,p=this.options;this.mask();this.dialog.show()},close:function(){var g=this,p=this.options;this.unmask();this.dialog.remove()},success:function(options){var p=this.options;p.showMax=false;p.showMis=false;return new h.Dialog.success(p)}});$.hmilyDialog.open=function(p){return $.hmilyDialog(p)};$.hmilyDialog.confirm=function(content,title,callback){if(typeof(title)=="function"){callback=title}var btnclick=function(item,Dialog,index){Dialog.close();if(callback){callback(item.type=="yes")}};p={type:"question",content:content,buttons:[{text:$.hmilyDefaults.DialogString.yes,onclick:btnclick,type:"yes"},{text:$.hmilyDefaults.DialogString.no,onclick:btnclick,type:"no"}]};if(typeof(title)=="string"&&title!=""){p.title=title}$.extend(p,{width:300,height:150,showMax:false,showMin:false,modal:true});return $.hmilyDialog(p)};$.hmilyDialog.warning=function(content,title,callback){if(typeof(title)=="function"){callback=title}var btnclick=function(item,Dialog,index){Dialog.close();if(callback){callback(item.type)}};p={type:"warn",content:content,buttons:[{text:$.hmilyDefaults.DialogString.yes,onclick:btnclick,type:"yes"},{text:$.hmilyDefaults.DialogString.no,onclick:btnclick,type:"no"},{text:$.hmilyDefaults.DialogString.cancel,onclick:btnclick,type:"cancel"}]};if(typeof(title)=="string"&&title!=""){p.title=title}$.extend(p,{width:300,height:150,showMax:false,showMin:false,modal:true});return $.hmilyDialog(p)};$.hmilyDialog.alert=function(content,title,type,callback){if(typeof(title)=="function"){callback=title}else{if(typeof(type)=="function"){callback=type}}var btnclick=function(item,Dialog,index){Dialog.close();if(callback){callback(item,Dialog,index)}};p={content:content,buttons:[{text:$.hmilyDefaults.DialogString.ok,onclick:btnclick}]};if(typeof(title)=="string"&&title!=""){p.title=title}if(typeof(type)=="string"&&type!=""){p.type=type}$.extend(p,{width:300,height:150,showMax:false,showMin:false,modal:true});return $.hmilyDialog(p)};$.hmilyDialog.success=function(content,title,callback){return $.hmilyDialog.alert(content,title,"success",callback)};$.hmilyDialog.error=function(content,title,callback){return $.hmilyDialog.alert(content,title,"error",callback)};$.hmilyDialog.info=function(content,title,callback){return $.hmilyDialog.alert(content,title,"info",callback)};$.hmilyDialog.question=function(content,title,callback){return $.hmilyDialog.alert(content,title,"question",callback)};$.hmilyDialog.warn=function(content,title,callback){return $.hmilyDialog.alert(content,title,"warn",callback)}})(jQuery);